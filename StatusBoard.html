html_v3 = r"""<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Escape Room Status</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
  <style>
    :root {
      --bg:#0e0f12; --panel:#17181d; --muted:#a8adbd; --text:#e8eaf2;
      --ready:#2ea043; --pre:#38bdf8; --resetting:#9ca3af; --reset:#eab308; --ingame:#ef4444;
    }
    * { box-sizing:border-box; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif }
    body { margin:0; background:var(--bg); color:var(--text) }
    .wrap { max-width:1200px; margin:0 auto; padding:24px }
    h1 { margin:0 0 12px }
    .banner { display:none; background:#231b1b; border-left:4px solid #ef4444; padding:10px; border-radius:10px; margin-bottom:12px }
    .ok { background:#16231b; border-left-color:#2ea043 }
    .panel { background:#17181d; border-radius:16px; padding:16px; }
    .row { display:flex; gap:8px; align-items:center; justify-content:space-between }
    .role-buttons { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px }
    button { background:#1f222b; color:var(--text); border:1px solid #2a2e3a; padding:10px 14px; border-radius:10px; cursor:pointer }
    button[disabled] { opacity:.6; cursor:not-allowed }
    .grid { display:grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:12px; margin-top:12px }
    .card { background:#121319; border:1px solid #222632; border-radius:14px; padding:12px }
    .badge { display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid #2b2f3b; font-weight:600 }
    .dot { width:10px; height:10px; border-radius:50% }
    .legend { display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 0 }
    .subtle { color:var(--muted); font-size:13px }

    /* Room tile bar */
    .room-bar-wrap { margin-top:8px; }
    .room-bar { display:flex; gap:6px; overflow-x:auto; padding-bottom:6px; scrollbar-width:thin }
    .room-tile {
      min-width: 190px; height: 38px; border-radius:8px; display:flex; align-items:center; justify-content:center;
      color:#111; font-weight:800; letter-spacing:.5px; user-select:none; border:1px solid rgba(0,0,0,.25);
      transition: transform .08s ease, outline-color .2s ease;
    }
    .room-tile:hover { transform: translateY(-1px); }
    .room-tile.selected { outline:3px solid #ffffff55; }
    .room-title { font-weight:700; margin:10px 0 8px }

    /* Quick pad */
    .pad { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:10px; }
    .pad button {
      font-size:15px; font-weight:800; height:48px; border-radius:8px; border-width:2px;
      background:#6b7280; /* default */
    }
    .pad .b-ready { background:var(--ready) }
    .pad .b-preroom { background:var(--pre) }
    .pad .b-resetting { background:var(--resetting) }
    .pad .b-reset { background:var(--reset) }
    .pad .b-ingame { background:var(--ingame); color:#fff }
  </style>
</head>
<body>
<div class="wrap">
  <h1>Escape Room Status</h1>
  <div id="statusBanner" class="banner"></div>

  <div id="rolePicker" class="panel">
    <div class="subtle">Choose how you want to view/update rooms.</div>
    <div class="role-buttons">
      <button id="hostBtn" disabled>View All Rooms</button>
      <button id="roomBtn" disabled>Change Room Status</button>
      <button id="seedBtn" title="Set all rooms to Ready (runs once if needed)">Seed Rooms</button>
    </div>
  </div>

  <div id="hostPanel" class="panel" style="display:none">
    <div class="row">
      <strong>All Rooms</strong>
      <button onclick="showPicker()">← Back</button>
    </div>
    <div class="legend">
      <span class="badge"><span class="dot" style="background:var(--ready)"></span>Ready</span>
      <span class="badge"><span class="dot" style="background:var(--pre)"></span>Needs Pre-room</span>
      <span class="badge"><span class="dot" style="background:var(--resetting)"></span>Resetting</span>
      <span class="badge"><span class="dot" style="background:var(--reset)"></span>Needs Reset</span>
      <span class="badge"><span class="dot" style="background:var(--ingame)"></span>In-game</span>
    </div>
    <div id="hostGrid" class="grid"></div>
  </div>

  <div id="roomPanel" class="panel" style="display:none">
    <div class="row">
      <strong>Change Room Status</strong>
      <button onclick="showPicker()">← Back</button>
    </div>
    <div class="subtle">Click a room below, then tap a big button to set the status.</div>
    <div class="room-bar-wrap"><div id="roomBar" class="room-bar"></div></div>
    <div id="currentRoomTitle" class="room-title"></div>
    <div id="roomStatus" class="subtle">Current status: —</div>
    <div class="pad" style="margin-top:10px">
      <button class="b-ready" onclick="setStatus('Ready')">READY</button>
      <button class="b-preroom" onclick="setStatus('Needs Pre-room')">NEEDS PRE-ROOM</button>
      <button class="b-resetting" onclick="setStatus('Resetting')">RESETTING</button>
      <button class="b-reset" onclick="setStatus('Needs Reset')">NEEDS RESET</button>
      <button class="b-ingame" onclick="setStatus('In-game')">IN GAME</button>
    </div>
  </div>
</div>

<script>
  // Room data
  const roomData = [
    { name:"Bunker 2", abbr:"BUNKER 2", color:"#a4f2a4" },
    { name:"Bunker 1", abbr:"BUNKER 1", color:"#065f1a", text:"#e5ffe5" },
    { name:"Wild West Saloon", abbr:"WILD WEST SALOON", color:"#ffd300" },
    { name:"Chamber of Lost Legends", abbr:"CHAMBER OF LOST LEGENDS", color:"#8a4b13", text:"#fff" },
    { name:"Tesla's Mystery", abbr:"TESLA'S MYSTERY", color:"#8a8a8a" },
    { name:"Zodiac Killer", abbr:"ZODIAC KILLER", color:"#000000", text:"#ff3b3b" },
    { name:"Prison Break 1", abbr:"PRISON BREAK 1", color:"#ffb296" },
    { name:"Prison Break 2", abbr:"PRISON BREAK 2", color:"#7b0006", text:"#ffdede" },
    { name:"The Other Side", abbr:"THE OTHER SIDE", color:"#7b0f8f", text:"#eecbff" },
    { name:"Zombie Lab", abbr:"ZOMBIE LAB", color:"#bfe8f6" },
    { name:"Mastermind: A Heist Story", abbr:"MASTERMIND: A HEIST STORY", color:"#001aa8", text:"#b9c6ff" }
  ];
  const rooms = roomData.map(r => r.name);

  // Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyAP35nYn27RBPtU9DGObHyBLXKSkj-3eb4",
    authDomain: "room-status-fiabadl.firebaseapp.com",
    databaseURL: "https://room-status-fiabadl-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "room-status-fiabadl",
    storageBucket: "room-status-fiabadl.firebasestorage.app",
    messagingSenderId: "491942494195",
    appId: "1:491942494195:web:f6cc31819183baf9bd1c86",
    measurementId: "G-B7GVN01KG2"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  // Helpers
  const $ = (id) => document.getElementById(id);
  const banner = (msg, ok=false) => { const b=$('statusBanner'); b.textContent=msg; b.className='banner'+(ok?' ok':''); b.style.display='block'; };
  const showPicker = () => { $('hostPanel').style.display='none'; $('roomPanel').style.display='none'; $('rolePicker').style.display='block'; };
  const statusColor = (s) => ({
    "Ready":"var(--ready)",
    "Needs Pre-room":"var(--pre)",
    "Resetting":"var(--resetting)",
    "Needs Reset":"var(--reset)",
    "In-game":"var(--ingame)"
  }[s] || "var(--muted)");
  const encodeKey = (name) => name.replaceAll('.', '(dot)').replaceAll('#','(hash)').replaceAll('$','(dol)').replaceAll('[','(lb)').replaceAll(']','(rb)');

  // Auth
  auth.onAuthStateChanged(async (u) => {
    if (!u) return;
    banner("Connected ✓", true);
    $('hostBtn').disabled = false;
    $('roomBtn').disabled = false;

    $('hostBtn').onclick = () => { $('rolePicker').style.display='none'; $('hostPanel').style.display='block'; initHost(); };
    $('roomBtn').onclick = () => { $('rolePicker').style.display='none'; $('roomPanel').style.display='block'; initRoomBar(); };

    $('seedBtn').onclick = async () => {
      const root = db.ref('rooms'); const s = await root.get();
      if (s.exists()) { banner("Rooms already exist — not reseeding."); return; }
      const seed = {}; rooms.forEach(n => seed[encodeKey(n)] = { status:"Ready", updatedAt:Date.now() });
      await root.set(seed); banner("Seeded: all rooms set to Ready.", true);
    };

    // Auto-seed if empty
    const root = db.ref('rooms'); const s = await root.get();
    if (!s.exists()) {
      const seed = {}; rooms.forEach(n => seed[encodeKey(n)] = { status:"Ready", updatedAt:Date.now() });
      await root.set(seed); banner("Seeded: all rooms set to Ready.", true);
    }
  });
  auth.signInAnonymously().catch(e => banner("Anonymous sign-in error: "+e.message));
  db.ref('.info/connected').on('value', s => console.log('RTDB connected?', s.val()));

  // Host view
  function initHost(){
    const hostGrid = $('hostGrid'); hostGrid.innerHTML='';
    rooms.forEach((name) => {
      const card = document.createElement('div'); card.className='card';
      card.innerHTML = `<div style="font-weight:600;margin-bottom:8px">${name}</div>
        <div class="badge"><span class="dot"></span><span class="label">Loading…</span></div>`;
      hostGrid.appendChild(card);
      const dot = card.querySelector('.dot'); const label = card.querySelector('.label');
      db.ref(`rooms/${encodeKey(name)}/status`).on('value', snap => {
        const s = snap.val() || 'Unknown'; dot.style.background = statusColor(s); label.textContent = s;
      });
    });
  }

  // Room bar + quick pad
  let currentRoom = rooms[0];
  let currentRef = null;

  function initRoomBar(){
    const bar = $('roomBar'); bar.innerHTML='';
    roomData.forEach(rd => {
      const tile = document.createElement('div');
      tile.className = 'room-tile';
      tile.style.background = rd.color;
      if (rd.text) tile.style.color = rd.text;
      tile.textContent = rd.abbr;
      tile.title = rd.name;
      tile.onclick = () => selectRoom(rd.name, tile);
      bar.appendChild(tile);
    });
    const firstTile = bar.firstElementChild;
    if (firstTile) selectRoom(roomData[0].name, firstTile);
  }

  function selectRoom(roomName, tileEl){
    currentRoom = roomName;
    [...document.querySelectorAll('.room-tile')].forEach(el => el.classList.remove('selected'));
    tileEl.classList.add('selected');
    $('currentRoomTitle').textContent = roomName;

    if (currentRef) currentRef.off();
    currentRef = db.ref(`rooms/${encodeKey(roomName)}/status`);
    currentRef.on('value', snap => {
      $('roomStatus').textContent = `Current status: ${snap.val() || 'Unknown'}`;
    });
  }

  // Expose setStatus
  async function setStatus(status){
    const ref = db.ref(`rooms/${encodeKey(currentRoom)}`);
    await ref.update({ status, updatedAt: firebase.database.ServerValue.TIMESTAMP });
  }
  window.setStatus = setStatus;
</script>
</body>
</html>
